<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="SellerCenter">

    <select id="getCategoryList"
            parameterType="String"
            resultType="com.green.shopping.vo.CategoryVo">
        SELECT *
        FROM    Category_Tb
        WHERE NVL(parent_num,-1) = #{parent_num}
    </select>

    <insert id="insertProduct_Img"
            parameterType="java.util.HashMap">
        INSERT INTO Product_Img_Tb(File_Name, Product_Num, IsMain)
        VALUES (#{file_Name}, #{product_Num}, #{isMain})
    </insert>

    <insert id="createProduct"
            parameterType="java.util.HashMap">

        INSERT INTO Product_Tb(Id,Market_Name,Category,Title,Cont,Event)
        VALUES (product_tb_seq.nextval,#{market_name},#{category},#{title},#{cont},#{event})

        <selectKey keyProperty="Id" resultType="String" order="AFTER">
            select product_tb_seq.currval from dual
        </selectKey>
    </insert>

    <insert id="createProductDetail"
            parameterType="java.util.HashMap">

        INSERT INTO ProductDetail_Tb(Id,Product_Id,Product_Name,Product_Price,Product_Discount,Product_Count,DateStart,DateEnd)
        VALUES (product_detail_tb_seq.nextval,#{product_Id},#{product_Name},#{product_Price},#{product_Discount},#{product_Count},#{dateStart},#{dateEnd})

        <selectKey keyProperty="Id" resultType="String" order="AFTER">
            select product_detail_tb_seq.currval from dual
        </selectKey>
    </insert>

    <select id="getProductIdListByMarketName" resultType="map" parameterType="String">
        select id, title from product_tb
        where market_name = #{marketName}
    </select>

    <select id="getPurchasedListByProductId" resultType="map" parameterType="Object">
        select id, productid, state, TO_CHAR(TIME + 9/24, 'yyyy-mm-dd hh24:mi:ss') AS TIME, postaddressid
        from purchaselist_tb
        where productid = #{productid}
    </select>

    <select id="getPostAddressById" parameterType="Integer" resultType="map">
        select * from PostAddress_Tb
        where id = #{id}
    </select>

    <select id="getOrderDetail" parameterType="Integer" resultType="map">
        select a.productdetailid ,a.count, b.product_name
        from purchasedetaillist_tb a, productdetail_tb b
        where a.purchaselistid = #{orderNum} and a.productdetailid = b.id
    </select>

    <update id="updateOrderStatus" parameterType="java.util.HashMap">
        update purchaselist_tb
        set state = #{status}
        where id = #{orderNum}
    </update>

    <insert id="insertPostInfo" parameterType="java.util.HashMap">
        insert into post_tb(invoice_number,companyname,purcharselistid)
        values (#{invoiceNum},#{companyName},#{purchaseNum})
    </insert>

    <select id="getReviewListCount" resultType="com.green.shopping.vo.ReviewVo">
        SELECT (R.STAR)
        FROM MARKET_TB M JOIN PRODUCT_TB P ON M.NAME = P.MARKET_NAME JOIN REVIEW_TB R
        ON P.ID = R.PRODUCT_NUM
        WHERE SELLERID = #{user_id} AND R.TIME BETWEEN TO_DATE(#{start}, 'yyyy-mm-dd') AND TO_DATE(#{end}, 'yyyy-mm-dd')
    </select>
</mapper>



