<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="SellerCenter">

    <select id="getCategoryList"
            parameterType="String"
            resultType="com.green.shopping.vo.CategoryVo">
        SELECT *
        FROM    Category_Tb
        WHERE NVL(parent_num,-1) = #{parent_num}
    </select>

    <insert id="insertProduct_Img"
            parameterType="java.util.HashMap">
        INSERT INTO Product_Img_Tb(File_Name, Product_Num, IsMain)
        VALUES (#{file_Name}, #{product_Num}, #{isMain})
    </insert>

    <insert id="createProduct"
            parameterType="java.util.HashMap">

        INSERT INTO Product_Tb(Id,Market_Name,Category,Title,Cont,Event)
        VALUES (product_tb_seq.nextval,#{market_name},#{category},#{title},#{cont},#{event})

        <selectKey keyProperty="Id" resultType="String" order="AFTER">
            select product_tb_seq.currval from dual
        </selectKey>
    </insert>

    <insert id="createProductDetail"
            parameterType="java.util.HashMap">

        INSERT INTO ProductDetail_Tb(Id,Product_Id,Product_Name,Product_Price,Product_Discount,Product_Count,DateStart,DateEnd)
        VALUES (product_detail_tb_seq.nextval,#{product_Id},#{product_Name},#{product_Price},#{product_Discount},#{product_Count},#{dateStart},#{dateEnd})

        <selectKey keyProperty="Id" resultType="String" order="AFTER">
            select product_detail_tb_seq.currval from dual
        </selectKey>
    </insert>

    <select id="getProductIdListByMarketName" resultType="map" parameterType="String">
        select id, title from product_tb
        where market_name = #{marketName}
    </select>

    <select id="getPurchasedListByProductId" resultType="map" parameterType="Object">
        select id, productid, state, TO_CHAR(TIME + 9/24, 'yyyy-mm-dd hh24:mi:ss') AS TIME, postaddressid
        from purchaselist_tb
        where productid = #{productid}
    </select>

    <select id="getPostAddressById" parameterType="Integer" resultType="map">
        select * from PostAddress_Tb
        where id = #{id}
    </select>

    <select id="getOrderDetail" parameterType="Integer" resultType="map">
        select a.productdetailid ,a.count, b.product_name
        from purchasedetaillist_tb a, productdetail_tb b
        where a.purchaselistid = #{orderNum} and a.productdetailid = b.id
    </select>

    <update id="updateOrderStatus" parameterType="java.util.HashMap">
        update purchaselist_tb
        set state = #{status}
        where id = #{orderNum}
    </update>

    <insert id="insertPostInfo" parameterType="java.util.HashMap">
        insert into post_tb(invoice_number,companyname,purcharselistid)
        values (#{invoiceNum},#{companyName},#{purchaseNum})
    </insert>

    <select id="getPurchaseConfirm"
            resultType="com.green.shopping.vo.purchaseconfirmVo">
            SELECT  U.id as id , M.NAME as marketname, M.SELLERID as sellerid , P.TITLE as title, U.USER_ID as buyerid, U.TOTALPRICE as totalprice, U.DELIVERY as delivery, U.TIME as purchasetime, TO_CHAR(U.PURCHASECONFIRMTIME, 'YYYY-MM-DD HH24:MI:SS') as purchaseconfirmtime
            FROM    MARKET_TB M LEFT JOIN PRODUCT_TB P
            ON      M.NAME = P.MARKET_NAME
            LEFT JOIN PURCHASELIST_TB U
            ON      P.ID = U.PRODUCTID
            WHERE   U.PURCHASECONFIRMTIME BETWEEN TO_DATE(#{start}, 'YYYY-MM-DD') AND LAST_DAY(TO_DATE(#{end}, 'YYYY-MM-DD'))
            AND     M.SELLERID = #{user_id}
    </select>

    <select id="getPurchasedDetailInfo"
            resultType="com.green.shopping.vo.PurchaseDetailVo">
            SELECT T.ID as id, T.PRICE as price, T.COUNT as count, T.SALE as sale, T.PRODUCTDETAILID as productdetailid, T.PURCHASELISTID as purchaselistid, P.PRODUCT_NAME as product_name
            FROM PURCHASEDETAILLIST_TB T LEFT JOIN PRODUCTDETAIL_TB P
            ON T.PRODUCTDETAILID = P.ID
            WHERE   PURCHASELISTID = #{id}

    </select>
</mapper>



